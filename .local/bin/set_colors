#!/bin/bash

#-Set my system colors using pywal

background="$HOME/repos/wallpapers/folhas.png"
colors="$HOME/repos/wallpapers/folhas.png"

colors_relative()
{
	old=$(echo 'colors="$HOME/repos/wallpapers/folhas.png"' | sed  's/\//\\\//g')
	new=$(echo 'colors="$HOME/'"$1"'"' | sed  's/\//\\\//g')
	sed -i "s/$old/$new/g" "$HOME/.local/bin/set_colors"

}

colors_absolute()
{
	old=$(echo 'colors="$HOME/repos/wallpapers/folhas.png"' | sed  's/\//\\\//g')
	new=$(echo 'colors="'"$1"'"' | sed  's/\//\\\//g')
	sed -i "s/$old/$new/g" "$HOME/.local/bin/set_colors"
}

background_relative()
{
	old=$(echo 'background="$HOME/repos/wallpapers/folhas.png"' | sed  's/\//\\\//g')
	new=$(echo 'background="$HOME/'"$1"'"' | sed  's/\//\\\//g')
	sed -i "s/$old/$new/g" "$HOME/.local/bin/set_colors"

}

background_absolute()
{
	old=$(echo 'background="$HOME/repos/wallpapers/folhas.png"' | sed  's/\//\\\//g')
	new=$(echo 'background="'"$1"'"' | sed  's/\//\\\//g')
	sed -i "s/$old/$new/g" "$HOME/.local/bin/set_colors"
}

colors()
{
	#rewrite line 5 with $1 to set default
	if [ "$1" ]
	then
		colors="$1"

		if [ "${1:0:1}" == '/' ]; then
			colors_absolute "$1"
		else
			colors_relative "$1"
		fi

		wal -n -i "$colors"

		#Make a wal file that can acctualy be used for dwm
		#The default one causes errors
		cp "$HOME/.cache/wal/colors-wal-dwm.h" "$HOME/.cache/wal/colors-wal-dwm-real.h"
		sed -i "s/\[SchemeNorm\] = //g" "$HOME/.cache/wal/colors-wal-dwm-real.h"
		sed -i "s/\[SchemeSel\]  = //g" "$HOME/.cache/wal/colors-wal-dwm-real.h"
		sed -i "s/\[SchemeUrg\] = //g" "$HOME/.cache/wal/colors-wal-dwm-real.h"
	else
		wal -n -i "$colors"
	fi
}


wallpaper()
{
	#rewrite line 6 with $1 to set default
	if [ "$1" ]
	then
		background="$1"

		if [ "${1:0:1}" == '/' ]; then
			background_absolute "$1"
		else
			background_relative "$1"
		fi
	fi

	xwallpaper --output all --stretch "$background"
}

case $1 in
	-w) shift; wallpaper "$1"
		;;
	*) colors "$1"; shift
		;;
esac
